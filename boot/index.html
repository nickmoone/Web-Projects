<!DOCTYPE html>
<html>
    <head>
        <title>Boot Dashboard</title>

        <script type="text/javascript" src="../bruglichten/bruglichten.js"></script>
        <link rel="stylesheet" href="../bruglichten/bruglichten.css">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://kit.fontawesome.com/49107a8060.js" crossorigin="anonymous"></script>

        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

        <style>
            body, html {
              height: 100%;
              margin: 0;
            }
        </style>
        
        <script>
            var interval;
            var lastLocation = null;
            var lastTime = null;

            geo = navigator.geolocation;
            function getSpeed(intervalTime) {

                if (geo) {
                    document.getElementById("kmu").innerHTML = "km/u";
                    document.getElementById("ms").innerHTML = "m/s";

                    if (interval) {
                        clearInterval(interval);
                    }

                    geo.getCurrentPosition(showPosition);
                    interval = setInterval(function() {geo.getCurrentPosition(showPosition);}, intervalTime);
                }
                else {
                    document.getElementById("speed").innerHTML = "";
                    document.getElementById("speedMs").innerHTML = "This device does not support GPS speed or you have GPS permissions disabled.";
                }
            }

            function deg2rad(deg) {
                return deg * (Math.PI/180)
            }

            function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
                var R = 6371; // Radius of the earth in km
                var dLat = deg2rad(lat2-lat1);  // deg2rad below
                var dLon = deg2rad(lon2-lon1); 
                var a = 
                    Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
                    Math.sin(dLon/2) * Math.sin(dLon/2)
                    ; 
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
                var d = R * c; // Distance in km
                return d;
            }
            
            function showPosition(position) {
                var newLocation = [position.coords.latitude, position.coords.longitude];
                var newTime = position.timestamp;
                
                if (lastLocation != null && lastTime != null) {
                    var distance = getDistanceFromLatLonInKm(lastLocation[0], lastLocation[1], newLocation[0], newLocation[1]); // Km
                    distance = distance * 1000; // Meters
                    var time = (newTime - lastTime) / 1000; // Seconds
                    if (time > 0) {
                        var speed = distance / time; // Meters per second
                        document.getElementById("speed").innerHTML = (speed*3.6).toFixed(0);
                        document.getElementById("speedMs").innerHTML = speed.toFixed(0);
                    }
                }
                else {
                    document.getElementById("speed").innerHTML = "0";
                    document.getElementById("speedMs").innerHTML = "0";
                }

                lastLocation = newLocation;
                lastTime = newTime;
            }

            $(document).ready(function() {getSpeed(3000);});
        </script>
    </head>
    <body>
        <div class="w3-display-container" style="height: 100%;">
            <iframe src="https://www.google.com/maps/d/embed?mid=16SIV9ZDLfYejT23rbmdiQdvMggTblTxf&ehbc=2E312F" width="100%" height="100%" style="position: fixed; top: -80px; z-index: -1;"></iframe>

            <div style="margin: auto; width: 180px">
                <div id="top1" class="light color-yellow" style="float: left;" onclick="toggleLight(this)"></div>
                <div id="top2" class="light color-yellow" style="float: right;" onclick="toggleLight(this)"></div>
            </div>
            <br>
            <div id="left1" class="circle color-red" onclick="changeColor(this)"></div>
            <div id="right1" class="circle color-red" style="float: right" onclick="changeColor(this)"></div>
            <br>
            <div id="left2" class="circle color-red" onclick="changeColor(this)"></div>
            <div id="right2" class="circle color-red" style="float: right;" onclick="changeColor(this)"></div>
            <br>
            <div class="w3-card-4 w3-dark-grey w3-bottom" style="margin-bottom: 80px;">
                <p id="permission" class="w3-xlarge" style="text-align: center;"></p>
                <p id="reason" class="w3-large" style="text-align: center;"></p>
            </div>
        </div>

        <div class="w3-display-container w3-blue w3-bottom" style="height: 80px;">
            <div class="w3-left" style="padding-left: 16px; margin-top: -8px">
                <span id="speed" class="w3-jumbo">0</span> <span id="kmu" class="w3-large"></span>
                <span class="w3-large">&nbsp;</span>
                <span id="speedMs" class="w3-xxlarge">0</span> <span id="ms" class="w3-medium"></span>
            </div>
            <div class="w3-display-right" style="margin-top: 4px;">
                <a class="w3-padding-large" href="https://www.sloepennetwerk.nl/routeplanner"><i class="fa-solid fa-map-location w3-xxlarge w3-center"><div class="w3-small"><br>routes</div></i></a>
                <a class="w3-padding-large" href="https://www.varendoejesamen.nl/kenniscentrum/artikel/bekijk-de-overzichtskaart-snelvaargebieden/"><i class="fa-solid fa-road w3-xxlarge w3-center"><div class="w3-small"><br>gebieden</div></i></a>
                <a class="w3-padding-large" href="https://www.vaarbewijzen.nl/boetes-op-het-water/"><i class="fa-solid fa-coins w3-xxlarge w3-center"><div class="w3-small"><br>boetes</div></i></a>
                <a class="w3-padding-large" href="https://wetten.overheid.nl/BWBR0003628/2016-01-01"><i class="fa-solid fa-book w3-xxlarge w3-center"><div class="w3-small"><br>BPR</div></i></a>
                <a class="w3-padding-large" href="/boot/vanvossen.html"><i class="fa-solid fa-ship w3-xxlarge w3-center"><div class="w3-small"><br>boot</div></i></a>
                <a class="w3-padding-large" href="/boot/nood.html"><i class="fa-solid fa-triangle-exclamation w3-xxlarge w3-text-amber w3-center"><div class="w3-small"><br>nood</div></i></a>
            </div>
        </div>
    </body>
</html>
